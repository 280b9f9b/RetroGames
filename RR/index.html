<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="apple-touch-icon" href="covers/icon.png">
		<title>RetroGames</title>
		<style>
			body, html {
			height: 100%;
			background-color: #1c1c1c;
			color: white;
			font-family: 'Brush Script MT', cursive;
			}
			body {
			margin: 0;
			}
			body, #box, #top {
			align-items: center;
			justify-content: center;
			flex-direction: column;
			}
			.game-container {
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			padding-top: 150px;
			}
			.game-container .game {
			display: inline-block;
			vertical-align: top;
			margin: 10px;
			margin-top: 10px;
			width: 160px;
			height: 300px;
			border-radius: 5px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
			background-color: #2c2c2c;
			overflow: hidden;
			transition: transform 0.2s ease-in-out;
			text-align: left;
			}
			.game-container .game img {
			width: 160px;
			height: 225px;
			margin-bottom: 1px;
			border: 2px;
			border-radius: 5px;
			cursor: pointer;
			transition: transform 0.3s ease;
			}
			.game-container .game img:hover {
			transform: scale(1.05);
			}
			.game-container .game h2 {
			margin-top: 0px;
			margin-left: 10px;
			margin-right: 10px;
			font-size: 13px;
			text-align: left;
			font-family: 'Brush Script MT', cursive;
			overflow: hidden!important;
			text-overflow: ellipsis;
			white-space: nowrap!important;
			}
			.game-container .game p {
			margin-top: 1px;
			margin-left: 10px;
			margin-right: 10px;
			font-size: 11px;
			font-family: 'Brush Script MT', cursive;
			text-align: justify;
			hyphens: auto;
			-webkit-hyphens: auto;
			word-spacing: -0.05em;
			color: #aaa;
			}
			header {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			background-color: #333; /* Choose your desired background color */
			color: #fff; /* Choose your desired text color */
			padding: 10px;
			z-index: 1000; /* Ensure it's above other elements */
			}
			header h1 {
			font-size: 18px;
			margin: 0;
			}
			#core-controls,
			#controls {
			display: flex;
			align-items: center;
			margin-top: 10px;
			}
			#core-controls label,
			#controls label {
			margin-right: 10px;
			}
			#core-controls select,
			#controls input[type="text"],
			#controls select {
			padding: 5px;
			font-size: 12px;
			border-radius: 5px;
			border: none;
			background-color: #2c2c2c;
			color: #fff;
			width: 200px;
			}
			h3 {
			padding: 5px;
			font-size: 12px;
			border-radius: 5px;
			border: none;
			background-color: #2c2c2c;
			color: #fff;
			width: 200px;
			}
			.image-container {
			position: relative;
			display: inline-block;
			height: 75%;
			}
			.rating-label {
			position: absolute;
			top: 3px;
			right: 3px;
			background-color: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 5px;
			border-radius: 5px;
			font-size: 8px;
			}
		</style>
	</head>
	<body>
		<header>
			<h1>RetroGames...</h1>
			<div id="controls">
				<input type="text" id="search" placeholder="Enter a keyword">&nbsp;&nbsp;
				<select id="sort">
					<option value="title">Title</option>
					<option value="year">Year</option>
					<option value="core">Platform</option>
					<option value="players">Players</option>
					<option value="rating">Rating</option>
				</select>
			</div>
			<div id="core-controls">
				<select id="core-filter">
					<option value="all">All platforms</option>
					<!-- Filter options will be dynamically generated here -->
				</select>
				&nbsp;&nbsp;
				<h3 id="xtitle-count"></h3>
			</div>
		</header>
		<!-- Display container for games -->
		<div class="game-container" id="game-container"></div>
		<script>
			// Function to fetch JSON data
			async function fetchData(url) {
			    try {
			        const response = await fetch(url);
			        if (!response.ok) {
			            throw new Error('Network response was not ok');
			        }
			        return await response.json();
			    } catch (error) {
			        console.error('Error fetching data:', error);
			    }
			}
			
			// Function to sort games based on a property and direction
			function sortGames(property, direction) {
			    const gamesContainer = document.getElementById('game-container');
			    const games = Array.from(gamesContainer.children);
			
			    games.sort((a, b) => {
			        const gameA = a.querySelector('p').textContent.toLowerCase();
			        const gameB = b.querySelector('p').textContent.toLowerCase();
			
			        if (direction === 'asc') {
			            return gameA[property] > gameB[property] ? 1 : -1;
			        } else {
			            return gameA[property] < gameB[property] ? 1 : -1;
			        }
			    });
			
			    games.forEach(game => {
			        gamesContainer.appendChild(game);
			    });
			}
			
			document.getElementById('sort').addEventListener('change', function() {
			    const sortBy = this.value; // Get selected sorting option
			    const sortDirection = 'asc'; // or 'desc' based on user preference
			    sortGames(sortBy, sortDirection);
			});
			
			// Function to filter games based on the selected platform
			function filterGamesByCore(core) {
			    const gamesContainer = document.getElementById('game-container');
			    const games = Array.from(gamesContainer.children);
			
			    games.forEach(game => {
			        const gameCore = game.dataset.core;
			        if (core === 'all' || gameCore === core) {
			            game.style.display = 'block';
			        } else {
			            game.style.display = 'none';
			        }
			    });
			
			    updateGameCount(); // Update the game count after filtering
			}
			
			// Function to search games based on the entered keyword
			function searchGames(keyword) {
			    const gamesContainer = document.getElementById('game-container');
			    const games = Array.from(gamesContainer.children);
			
			    games.forEach(game => {
			        const title = game.querySelector('p').textContent.toLowerCase();
			        if (title.includes(keyword.toLowerCase())) {
			            game.style.display = 'block';
			        } else {
			            game.style.display = 'none';
			        }
			    });
			
			    updateGameCount(); // Update the game count after searching
			}
			
			// Function to display game images and load game on click
			async function displayGames() {
			    const games = await fetchData('games.json');
			    const gameContainer = document.getElementById('game-container');
			
			    games.forEach(game => {
			        // Create a container for each game
			        const gameDiv = document.createElement('div');
			        gameDiv.classList.add('game');
			        gameDiv.dataset.core = game.xcore; // Add xcore as a data attribute
			
			        // Create an image container
			        const imageContainer = document.createElement('div');
			        imageContainer.classList.add('image-container');
			
			        // Create an image element
			        const image = document.createElement('img');
			        if (game.ximage) {
			            image.src = game.ximage;
			            image.addEventListener('click', () => loadGame(game));
			            imageContainer.appendChild(image);
			        }
			
			        // Create a rating label
			        const ratingLabel = document.createElement('div');
			        ratingLabel.classList.add('rating-label');
			        ratingLabel.textContent = `${game.rating}`;
			        imageContainer.appendChild(ratingLabel);
			
			        gameDiv.appendChild(imageContainer);
			
			        // Create a paragraph element for the title
			        const titlePara = document.createElement('h2');
			        titlePara.textContent = game.xtitle;
			        gameDiv.appendChild(titlePara);
			
			        // Create a paragraph element for additional information
			        const infoPara = document.createElement('p');
			        infoPara.textContent = `${game.year} ${game.platform} ${game.players} ${game.genres}`;
			        gameDiv.appendChild(infoPara);
			
			        // Add the game container to the main container
			        gameContainer.appendChild(gameDiv);
			    });
			
			    updateGameCount(); // Update the game count after displaying games
			}
			
					// Function to load game using EmulatorJS
function loadGame(game) {
    const div = document.createElement("div");
    const script = document.createElement("script");

    const gameContainer = document.getElementById('game-container');
    gameContainer.innerHTML = ''; // Clear game container

    gameContainer.appendChild(div);

    window.EJS_player = "#game-container"; // Set player to game container
    window.EJS_gameName = game.xtitle;
    window.EJS_biosUrl = "";
    window.EJS_gameUrl = game.xgameUrl;
    window.EJS_core = game.xcore;
    window.EJS_pathtodata = "data/";
    window.EJS_startOnLoaded = true;
    window.EJS_DEBUG_XX = false;
    window.EJS_disableDatabases = true;
    window.EJS_threads = false;
    window.EJS_cheats = game.xcheats; // Pass cheats information

    script.src = "data/loader.js";
    document.body.appendChild(script);

    // Apply styles to game container
    gameContainer.style.padding = '0';
    gameContainer.style.margin = '0';
    gameContainer.style.width = '100vw';
    gameContainer.style.height = '100vh';

    // Hide the header
    const header = document.querySelector('header');
    header.style.display = 'none';

    // Listen for 'keyup' event to close the game
    window.addEventListener('keyup', closeGame);

    // Function to close the game and return to previous page
    function closeGame(event) {
        // Check if 'Escape' key is pressed
        if (event.key === 'Escape') {
            // Go back to the previous page in the browser's history
            window.history.back();
        }
    }
}
			
			
			
			
			
			
			
			
			
			
			
			
			// Function to update the game count
			function updateGameCount() {
			    const gamesContainer = document.getElementById('game-container');
			    const displayedGames = Array.from(gamesContainer.children).filter(game => game.style.display !== 'none');
			    document.getElementById('xtitle-count').textContent = `Total Games: ${displayedGames.length}`;
			}
			
			// Fetch data and display games
			async function init() {
			    await displayGames();
			
			    // Populate the core filter options
			    const games = await fetchData('games.json');
			    const cores = [...new Set(games.map(game => game.xcore))];
			    const coreFilter = document.getElementById('core-filter');
			    cores.forEach(core => {
			        const option = document.createElement('option');
			        option.value = core;
			        option.textContent = core;
			        coreFilter.appendChild(option);
			    });
			
			    // Add event listener for core filter change
			    coreFilter.addEventListener('change', function() {
			        const selectedCore = this.value;
			        filterGamesByCore(selectedCore);
			    });
			
			    // Add event listener for search input
			    const searchInput = document.getElementById('search');
			    searchInput.addEventListener('input', function() {
			        const keyword = this.value;
			        searchGames(keyword);
			    });
			}
			
			// Initialize the application
			init();
		</script>
	</body>
</html>
